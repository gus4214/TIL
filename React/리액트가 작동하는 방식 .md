# 리액트가 작동하는 방식

## 리액트란 무엇인가?

**사용자 인터페이스 구축**을 위한 자바스크립트 기반 라이브러리이다.

리액트의 핵심은?? **“Component”**

- 사용자 인터페이스를 구축하기 위해 컴포넌트를 사용한다.
- 사용자 인터페이스를 효과적으로 구성하며 이에 대한 업데이트 역시 컴포넌트를 활용하여 할 수 있다.

<br />

### 여기서 중요한 개념은 리액트 DOM

👉 리액트 DOM은 웹에 대한 인터페이스 !!

리액트는 웹을 모른다. 컴포넌트를 어떻게 다루는지는 알지만 컴포넌트에 HTML 요소들이 포함되어 있는지 or 허구적인 요소들이 있는지에 대해서는 상관하지 않는다.

→ 이는 실제 HTML 요소들을 화면에 표시해주는 리액트 DOM이 고려할 것들이다.

리액트는 컴포넌트를 관리하고 상태 객체를 관리하고 다른 객체의 상태와 컴포넌트가 바뀌어야 하는지를 확인하고 컴포넌트의 변경 전후의 상태를 확인할 뿐이다.

리액트는 변경된 내용과 화면에 표시되어야 할 정보 모두를 현재 사용중인 인터페이스에 전달한다. ex) 리액트 DOM

리액트 DOM은 브라우저의 일부인 실제 DOM에 대한 작업을 하므로 사용자가 보고 있는 화면에 무언가를 표시하는 역할은 리액트 DOM의 몫이다.

리액트는 컴포넌트 내부의 데이터인 **상태**를 다룬다.
(또 컴포넌트 전체의 데이터인 컨텍스트라는 것도 다룸)
→ 이 것이 바로 리액트의 핵심 기능

props, 상태, 컨텍스트가 변경이 되면 이 것을 사용하는 컴포넌트 역시 리액트를 통해 변경이 되고, 이 컴포넌트가 화면에 새로운 것을 표시하는지에 대해 확인한다.

→ 이렇게 화면에 무엇인가를 그리려 한다면 리액트는 리액트 DOM에 이를 알려
리액트 DOM이 새로운 화면과 새로운 컴포넌트 그리고 새로운 출력을 표시할 수 있게 해준다.

결과적으로 리액트가 하는 역할은 **Virtual DOM**이라는 개념을 사용하는 것!

<br />

### Virtual DOM은 앱이 마지막에 만들어내는 컴포넌트 트리를 결정

각각 하위 트리를 갖고 있는 컴포넌트들은 JSX 코드를 반환하는데,
이 Virtual DOM은 컴포넌트 트리의 현재 모양과 최종 모양을 정한다.

→ 상태가 업데이트 되면 리액트 DOM으로 이 정보가 전달되어 갱신 전후의
상태 차이를 인식하고 리액트가 컴포넌트 트리를 통해 구성한 가상 DOM과
일치하도록 실제 DOM을 조작하는 방법을 알 수 있게 한다.

여기서 중요한 것은
이 과정 내내 리액트는 컴포넌트 함수를 재실행하고 컴포넌트를 재평가한다.

👉 상태, props, 컨텍스트, 컴포넌트에 변화가 발생하면 컴포넌트 함수가 재실행 되어

리액트가 이를 재평가 하게 된다. 하지만 이러한 재평가가 DOM을 다시 랜더링 하는 것은 아니다.

컴포넌트는 상태, props, 컨텍스트가 변경될 때 재평가되고, 리액트는 컴포넌트 함수를 다시 실행한다. 하지만 실제 DOM은 리액트가 구성한 컴포넌트의 이전 상태와 트리, 현재 상태간의 차이점을 기반으로 변경이 필요할 때만 업데이트 된다.

즉, 실제 DOM은 필요한 경우에만 변경되는 것!!

이러한 것은 성능 측면에서
이전과 현재 상태를 가상으로 비교한다는 것은 간편하고, 자원도 적게 들기 떄문에 매우 중요하다. → 이 작업은 메모리 안에서만 발생

실제 DOM을 사용하는 것 (브라우저에 직접 렌더링하는 것)은 성능 측면에서 자원이 많이 필요하게 된다.

여러 곳에서 소규모 변경이 발생하면 실제 DOM을 그만큼 많이 사용하므로 페이지가 느려질 수 있는 것이다.

리액트는 가상 DOM과의 비교를 통해 최종 스냅샷과 현재의 스냅샷을 실제 DOM에 전달하는 구조를 갖는다. → 이 것이 리액트가 작동하는 방식!!

```jsx
// 이전 평과 결과
<div>
  <span>hello</span>
</div>
```

```jsx
// 현재의 평가 결과
<div>
  <span>hello</span>
  <p>I`m a man</p>
</div>
```

이전과 현재를 비교했을 떄 새로운 문장을 더 보여주는 것이 현재의 평가 결과이다.

이 경우에 리액트는 이 두 스냅샷의 차이점이 이 문장임을 확인하고

이를 리액트 DOM에 보고하면 리액트 DOM은 실제 DOM을 업데이트하고
새로운 문장을 집어넣게 된다.

리액트 DOM은 전체 DOM을 리랜더링 하지 않는다.

→ `span` 이나 `div` 요소는 건드리지 않고 `p` 문장만을 추가한다.

이 것이 백그라운드에서 리액트가 작동하는 방식이다.

<br />

---

## 컴포넌트 업데이트 실행 중

부모 컴포넌트 함수가 재실행되면 자식 컴포넌트 함수도 재실행된다.

리액트의 컴포넌트는 함수로 이루어져 있고 함수 부분에는 JSX 코드를 반환하므로
결국 모든 JSX 요소들은 컴포넌트 함수에 대한 함수 호출과 같다.

컴포넌트 재평가와 컴포넌트 함수의 재실행이 일어나도 실제 DOM이 다시 렌더링되거나, 변경되는 것은 아니다.

컴포넌트가 재실행되면 이외 모든 자식 컴포넌트들 역시 재실행, 재평가 된다.
